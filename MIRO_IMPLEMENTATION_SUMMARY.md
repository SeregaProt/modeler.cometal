# Реализация логики связей в стиле Miro.com

## Что было сделано

### 1. Полная переработка ProcessMapPage.js
- Удалена старая логика ReactFlow onConnect/onConnectStart/onConnectEnd
- Реализована новая логика в стиле Miro с использованием MiroConnectionManager
- Упрощены стили связей и компоненты
- Добавлена интеграция с Smart Diagramming

### 2. ProcessNode.js - Точная копия поведения Miro
**Ключевые особенности:**
- Синие точки соединения появляются **только при выделении** объекта (selected=true)
- 4 основные точки соединения: top, right, bottom, left
- Точки имеют правильный стиль Miro: 8px, #0073e6, белая рамка
- При наведении точки увеличиваются и меняют цвет
- Клик по синей точке запускает Smart Diagramming

### 3. MiroConnectionManager.js - Менеджер соединений
**Функциональность:**
- Управляет созданием связей через drag & drop
- Обработка mouse events (mousemove, mouseup)
- Поиск целевых узлов при отпускании мыши
- Отмена создания связи по Escape
- React hook useMiroConnectionManager для интеграции

### 4. SimpleEdge.js - Упрощенные связи
**Особенности:**
- Базовая функциональность без сложных эффектов
- Кнопка удаления при выделении связи
- Hover эффекты
- Поддержка различных типов связей (one-to-one, one-to-many, many-to-many)

## Как работает новая логика (точно как в Miro)

### Выделение и создание связей
1. **Клик на процесс** → выделение процесса (появляются синие точки соединения)
2. **Клик на синюю т��чку** → запускается режим создания связи
3. **Клик на другой процесс** → создается связь между процессами
4. **Escape** → отмена создания связи

### Редактирование процессов
- **Кнопка "Открыть"** → переход в редактор процесса
- **Клик по карточке процесса** → только выделение (НЕ открытие редактора)

### Drag & Drop
1. **Перетаскивание от синей точки** → начало создания связи
2. **Отпускание на другом объекте** → создание связи
3. **Отпускание в пустом месте** → отмена

### Типы связей
- **Один к одному** (синяя сплошная линия)
- **Один ко многим** (оранжевая пунктирная линия)
- **Многие ко многим** (красная пунктирная линия)

## Ключевые отличия от старой реализации

### Удалено:
- Множественные Handle на узлах
- Сложная логика onConnect/onConnectStart/onConnectEnd
- CustomEdge с избыточными эффектами
- Сложные стили edgeStyles.js

### Добавлено:
- Точное поведение Miro: синие точки только при выделении
- Smart Diagramming: клик по точке → поиск ближайшего объекта
- Простой drag & drop между точками
- Правильная валидация соединений
- Отмена создания связи по Escape

## Файлы изменены:
- `/src/ProcessMapPage.js` - полностью перепис��н
- `/src/components/ProcessNode.js` - реализована логика Miro
- `/src/components/MiroConnectionManager.js` - новый файл
- `/src/components/SimpleEdge.js` - новый файл

## Результат
Теперь создание связей работает точно как в Miro.com:
- Синие точки соединения появляются только при выделении
- Клик по синей точке запускает Smart Diagramming
- Простой и интуитивный drag & drop
- Правильная валидация и отмена соединений

Приложение запущено на http://localhost:3001