# Логика создания связей в стиле Miro.com

## Обзор изменений

Реализована новая логика построения связей между процессами на карте процессов, полностью соответствующая принципам работы Miro.com.

## Ключевые особенности

### 1. Синие точки соединения (Connection Points)

- **Появление**: Точки соединения появляются только при выделении узла или наведении на него
- **Расположение**: 
  - Центральная точка (главная)
  - 4 основные точки (верх, право, низ, лево)
  - 4 дополнительные точки (углы) - показываются только при выделении/наведении
- **Визуальные эффекты**:
  - Базовый размер: 12px
  - При наведении: 14px с изменением цвета
  - При перетаскивании: 16px с увеличенной тенью

### 2. Smart Diagramming

- **Автоматическая проверка**: Система автоматически проверяет возможность создания связи
- **Предотвращение дубликатов**: Нельзя создать связь между уже связанными процессами
- **Предотвращение самосоединения**: Нельзя создать связь процесса с самим собой
- **Визуальная обратная связь**: Предварительный просмотр связи при перетаскивании

### 3. Drag & Drop взаимодействие

#### Создание связи:
1. Наведите на процесс - появятся синие точки соединения
2. Нажмите и удерживайте любую синюю точку
3. Перетащите к другому процессу
4. Отпустите на синей точке целевого процесса
5. Связь создается автоматически с выбранным типом

#### Удаление связи:
1. Кликните на линию связи для выделения
2. Нажмите кнопку удаления ��ли клавишу Delete
3. Связь будет удалена

### 4. Типы связей

- **Один к одному** (one-to-one): Синяя сплошная линия, толщина 2px
- **Один ко многим** (one-to-many): Оранжевая пунктирная линия, толщина 3px
- **Многие ко многим** (many-to-many): Красная пунктирная линия, толщина 4px, анимированная

### 5. Визуальные улучшения

- **Тени**: Все связи имеют тени для лучшей видимости
- **Анимации**: Плавные переходы при наведении и выделении
- **Информационные подсказки**: При наведении на связь показывается тип связи
- **Активные состояния**: Выделенные связи становятся толще и ярче

## Технические детали

### Компоненты

1. **ProcessNode.js**: 
   - Реализует логику отображения точек соединения
   - Управляет состояниями наведения и перетаскивания
   - Содержит множественные Handle для гибкого соединения

2. **CustomEdge.js**:
   - Улучшенная визуализация связей
   - Интерактивные элементы управления
   - Информационные подсказки

3. **edgeStyles.js**:
   - Централизованные стили для всех типов связей
   - Функции для различных состояний (активный, наведение)
   - Цветовая схема и описания

### Обработчики событий

- `onConnect`: Создание новой связи с проверками
- `onConnectStart`: Начало создания связи
- `onConnectEnd`: Завершение создания связи
- `isValidConnection`: Проверка возможности создания связи
- `onEdgeClick`: Выделение связи
- `handleKeyDown`: Удаление связи по клавише Delete

## Преимущества новой логики

1. **Интуитивность**: Поведение полностью соответствует Miro.com
2. **Визуальная ясность**: Т��чки соединения видны только когда нужны
3. **Гибкость**: Множественные точки соединения для точного позиционирования
4. **Безопасность**: Автоматическая проверка корректности связей
5. **Обратная связь**: Четкие визуальные индикаторы состояния

## Использование

### Для пользователей:
1. Выберите тип связи в меню инструментов
2. Наведите на процесс для отображения точек соединения
3. Перетащите от одной точки к другой
4. Связь создается автоматически

### Для разработчиков:
- Все стили централизованы в `edgeStyles.js`
- Логика соединения инкапсулирована в `ProcessMapPage.js`
- Компоненты полностью переиспользуемы

## Совместимость

- Полная совместимость с существующим API
- Сохранение всех существующих функций
- Улучшенная производительность за счет оптимизации рендеринга